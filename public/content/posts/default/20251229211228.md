---
title: Mastering MySQL 8 Dual Password: Seamless Credential Rotation for DBAs
date: 2025-12-29
excerpt: |
  Short summary goes here.
draft: true
---

## How Dual Password Works

- Allows two active passwords during transition periods
- Critical for zero-downtime credential rotation
- Enabled via RETAIN CURRENT PASSWORD clause

## Why DBAs Need This

- ✅ Security Compliance: Enforce periodic password changes without service disruption
- ✅ Application Resilience: Avoid "password lockout" during app updates

## Implementation Steps

> Versions
```
[root@localhost ~]# mysql -e "\s" | grep 'Server version'
mysql: [Warning] Using a password on the command line interface can be insecure.
Server version:         8.4.4 Galera Cluster for MySQL
```

> Create Testusers
```
root@test 11:11:  [(none)]> CREATE USER 'testuser'@'localhost' IDENTIFIED BY 'old_password';
Query OK, 0 rows affected (0.02 sec)

root@test 11:11:  [(none)]> GRANT SELECT ON *.* TO 'testuser'@'localhost';
Query OK, 0 rows affected, 1 warning (0.01 sec)

root@test 11:11:  [(none)]> flush privileges;
Query OK, 0 rows affected (0.01 sec)
```

> Tessting
```
[root@localhost ~]# mysql -u testuser -pold_password -e "SELECT '成功登入' AS message;"
mysql: [Warning] Using a password on the command line interface can be insecure.
+--------------+
| message      |
+--------------+
| 成功登入     |
+--------------+
```

> Enable Dual Password
```
root@test 11:11:  [(none)]> ALTER USER 'testuser'@'localhost' IDENTIFIED BY 'new_password' RETAIN CURRENT PASSWORD;
Query OK, 0 rows affected (0.01 sec)
```

> Test again
```
[root@localhost ~]# mysql -u testuser -pold_password -e "SELECT '舊密碼仍可登入' AS message;"
mysql: [Warning] Using a password on the command line interface can be insecure.
+-----------------------+
| message               |
+-----------------------+
| 舊密碼仍可登入        |
+-----------------------+
[root@localhost ~]# mysql -u testuser -pnew_password -e "SELECT '新密碼可登入' AS message;"
mysql: [Warning] Using a password on the command line interface can be insecure.
+--------------------+
| message            |
+--------------------+
| 新密碼可登入       |
+--------------------+
```

> mysql.user status checked.
(It looks like it uses the old_password_hash field to implement the functionality.)
```
root@test 11:11:  [(none)]> SELECT user, host, authentication_string,
    ->        JSON_EXTRACT(user_attributes, '$.additional_password') AS old_password_hash
    -> FROM mysql.user
    -> WHERE user = 'testuser';
+----------+-----------+------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------+
| user     | host      | authentication_string                                                  | old_password_hash                                                                                       |
+----------+-----------+------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------+
| testuser | localhost | $A$005$-n;     %L-%@HgG=bzA[4vHykP8V7GlFUprUxQjGGQBYkVYwToBDXjbb2amBAID | "$A$005$\tGK\u0014}\u0012MH\u001c\u001f\u000e7Rp\u0011Y*3Y|kdDrhmxgycLTb4eclo5Yi4wMgM1ZfqEDyiaCToj7Hw0" |
+----------+-----------+------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
```

> DISCARD OLD PASSWORD
```
root@test 11:12:  [(none)]> ALTER USER 'testuser'@'localhost' DISCARD OLD PASSWORD;
Query OK, 0 rows affected (0.01 sec)

root@test 11:12:  [(none)]> SELECT user, host, authentication_string,
    ->        JSON_EXTRACT(user_attributes, '$.additional_password') AS old_password_hash
    -> FROM mysql.user
    -> WHERE user = 'testuser';
+----------+-----------+------------------------------------------------------------------------+-------------------+
| user     | host      | authentication_string                                                  | old_password_hash |
+----------+-----------+------------------------------------------------------------------------+-------------------+
| testuser | localhost | $A$005$-n;     %L-%@HgG=bzA[4vHykP8V7GlFUprUxQjGGQBYkVYwToBDXjbb2amBAID | NULL              |
+----------+-----------+------------------------------------------------------------------------+-------------------+
1 row in set (0.00 sec)
```

> Test again
```
[root@localhost ~]# mysql -u testuser -pold_password -e "SELECT '這行不應執行' AS message;" 2>&1 | grep -i "access denied"
ERROR 1045 (28000): Access denied for user 'testuser'@'localhost' (using password: YES)

[root@localhost ~]# mysql -u testuser -pnew_password -e "SELECT '新密碼仍可登入' AS message;"
mysql: [Warning] Using a password on the command line interface can be insecure.
+-----------------------+
| message               |
+-----------------------+
| 新密碼仍可登入        |
+-----------------------+
```

Final Thoughts: A DBA's Perspective

While MySQL 8's Dual Password Support (RETAIN CURRENT PASSWORD) is a powerful tool for seamless credential rotation, it’s important to note its intentional simplicity:

- The feature deliberately lacks granular controls (e.g., auto-expiration timelines for old passwords) to enforce human oversight.

- As documented in MySQL Password Management, this design prioritizes controlled transitions over automation.