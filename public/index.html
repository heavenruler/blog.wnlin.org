<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Markdown-it Posts Feed</title>
    <style>
      :root {
        font: 16px "Inter", system-ui, sans-serif;
        color: #0f172a;
      }
      body {
        margin: 0;
        background: #f4f4f6;
      }
      header {
        padding: 2rem 1.5rem 1rem;
        background: #0f172a;
        color: #fff;
        text-align: center;
      }
      h1 {
        margin: 0;
        font-size: clamp(2rem, 2vw + 1rem, 2.8rem);
      }
      main {
        padding: 2rem 1.5rem;
        max-width: 960px;
        margin: 0 auto;
      }
      .tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }
      .tabs button {
        border: none;
        border-radius: 999px;
        padding: 0.4rem 1.25rem;
        background: #e0e7ff;
        color: #1e3a8a;
        font-weight: 600;
        cursor: pointer;
      }
      .tabs button.active {
        background: #1d4ed8;
        color: #fff;
      }
      .post-list {
        display: grid;
        gap: 1rem;
      }
      article {
        padding: 1.5rem;
        border-radius: 12px;
        background: #fff;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      }
      article h2 {
        margin-top: 0;
        margin-bottom: 0.25rem;
      }
      article p {
        margin: 0.25rem 0;
        color: #475569;
        line-height: 1.6;
        white-space: pre-line;
      }
      .empty {
        color: #64748b;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Markdown.it Feed</h1>
      <p>Posts are driven by `public/content/posts/manifest.json`.</p>
    </header>
    <main>
      <div class="tabs" id="tabs"></div>
      <section class="post-list" id="postList"></section>
    </main>
    <script>
      const manifestUrl = 'content/posts/manifest.json';
      const tabsEl = document.getElementById('tabs');
      const listEl = document.getElementById('postList');
      let manifest = null;
      let activeCategory = 'default';

      const renderTabs = () => {
        tabsEl.innerHTML = '';
        const categories = [
          { slug: 'default', label: 'default' },
          ...(manifest.categories || []),
        ];
        categories.forEach((category) => {
          const btn = document.createElement('button');
          btn.textContent = category.label;
          btn.dataset.slug = category.slug;
          if (activeCategory === category.slug) {
            btn.classList.add('active');
          }
          btn.addEventListener('click', () => {
            activeCategory = category.slug;
            updatePosts();
            renderTabs();
          });
          tabsEl.append(btn);
        });
      };

      const renderPosts = () => {
        const collection =
          activeCategory === 'default'
            ? manifest.default
            : manifest.categories.find((cat) => cat.slug === activeCategory);
        const posts = collection?.posts || [];
        listEl.innerHTML = '';
        if (!posts.length) {
          listEl.innerHTML =
            '<p class="empty">No posts found for this category.</p>';
          return;
        }
        posts.forEach((post) => {
          const article = document.createElement('article');
          article.innerHTML = `
            <h2>${post.title}</h2>
            <p><em>${new Date(post.date).toLocaleDateString()}</em></p>
            <p>${post.excerpt}</p>`;
          listEl.append(article);
        });
      };

      const updatePosts = () => {
        if (!manifest) {
          return;
        }
        renderPosts();
      };

      fetch(manifestUrl)
        .then((res) => res.json())
        .then((data) => {
          manifest = data;
          renderTabs();
          updatePosts();
        })
        .catch(() => {
          listEl.innerHTML =
            '<p class="empty">Unable to load posts. Run `make manifest` first.</p>';
        });
    </script>
  </body>
</html>
